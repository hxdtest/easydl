# Elastic Training Operator For EasyDL
The design described how the elastic operator manages Pods of a EasyDL
training job.

## Motivation
Computing Resources is important for training performance. EasyDL can
automatically configure resources of a job and dynamically adjust
resourdes of a job during training to optimize training performance.
The operator should be capable of modifing resoures of a job according
to a resource plan, such as scale up/down the number of Pods.

## Design
The `elastic-operator` consists of 2 new CRDs, `ElasticJob` and `JobResource`.

### ElasticJob
Users submit an `ElasticJob` to specify the job detail including the trainer's,
parameter server's and worker's image, entrypoint command. Users do not need to
specify any resource information like CPU/memory and replicas of workers 
in `ElasticJob`.  An example of
`ElasticJob` is 

```yaml
apiVersion: "elastic.easydl.org/v1alpha1"
kind: "ElasticJob"
metadata:
  name: "elastic-deepctr-job"
spec:
  command: "python -m model_zoo.iris.dnn_estimator"
  image:
  parameter_server:
    image: elasticdl:iris_estimator 
  worker:
    image: elasticdl:iris_estimator 
  evaluator:
    image: elasticdl:iris_estimator 
```

Firstly, the `elastic-operator` only creates a trainer Pod
and create PS/worker Pods by `JobResource` generated by the trainer.

### JobResource
We can submit a `JobResource` to specify resources of parameter servers and
workers. The `elastic-operator` will receive creation/updation events of
the `JobResource` and create corresponding Pods according resources spec in
the `JobResource`. An example of `JobResource` is 

```yaml
apiVersion: "elastic.easydl.org/v1alpha1"
kind: "JobResource"
metadata:
  name: "elastic-training-resource"
spec:
  selector:
    name: elastic-deepctr-job  // Job Name
  parameter_server:
    replicas: 4
    resource:
      cpu: 4
      memory: 4096
      disk: 8192
      gpu: 1
  worker:
    replicas: 4
    resource:
      cpu: 4
      memory: 4096
      disk: 8192
      gpu: 1
  evaluator:
    replicas: 1
    resource:
      cpu: 4
      memory: 4096
      disk: 8192
      gpu: 1
```

After the job starts, we can repeatedly modify and submit the `JobResource`.
The `elastic-operator` will reconcile against this definition. 

### EasyDL Automatically and Dynamically Configures Resources

